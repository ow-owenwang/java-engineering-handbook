# 过滤器

过滤器是一个可以拦截请求和响应并对其所包含的数据进行处理的对象。一般用来进行身份验证、日志记录、图像转换、数据压缩、加密、统一编码处理、敏感字符过滤等等。

过滤器必须实现 Filter 接口：

public class MyFilter implements Filter {    public void init(FilterConfig config) throws ServletException {    }    public void destroy() {    }    @Override    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws ServletException, IOException {        chain.doFilter(request, response);    }}

要想过滤器工作，必须像 Servlet 一样进行配置：

<filter>  <filter-name>MyFilter</filter-name>  <filter-class>org.example.filter.MyFilter</filter-class>  <init-param>    <param-name>param1</param-name>    <param-value>value1</param-value>  </init-param></filter><filter-mapping>  <filter-name>MyFilter</filter-name>  <url-pattern>/*</url-pattern></filter-mapping>

<url-pattern> 用来配置要拦截的路径，/* 表示拦截所有请求，包括 Servlet、JSP以及静态资源。也可以只对一个目标资源进行拦截，如：<url-pattern>/test.jsp</url-pattern>、<url-pattern>/MyServlet</url-pattern> 等。

当然，也可以通过注解进行配置：

@WebFilter(filterName = "MyFilter", value = "/*")public class Demo02Filter implements Filter {}

Filter 的接口方法 init() 和 Servlet 的 init() 类似，都是在对象初始化时执行一次。当容器加载 WEB 应用时会立即自动创建 Filter 对象，然后调用 init() 方法，通常用来加载资源。容器关闭时会销毁 Filter 对象，如果容器是正常关闭就会调用 destroy() 方法，此方法也是只执行一次，通常用来释放资源。

FilterConfig 装载有此过滤器的配置信息，通过它可以获取过滤器的信息和初始化参数。

doFilter() 方法在每一次正确拦截时都会调用，过滤器的逻辑代码应该在此方法中书写。当存在多个过滤器时，过滤器就形成了一个链，它们会依次执行。需要注意的是，执行顺序和配置方法有关，当使用 xml 配置过滤器时，执行顺序以 <filter-mapping> 的先后顺序为准，靠前的先执行；当以注解方式配置时，与过滤器的名称有关……

路径拦截的方式有以下几种：

@WebFilter("/index.jsp")：对具体资源文件进行拦截。只有访问 index.jsp 资源时，过滤器才会被执行。

@WebFilter("/user/*")：对目录进行拦截。访问 /user 下的所有资源时，过滤器都会被执行。

@WebFilter("*.jsp")：对扩展名进行拦截。访问所有后缀名为 jsp 的资源时，过滤器都会被执行。

@WebFilter(value = "/index.jsp", dispatcherTypes = DispatcherType.REQUEST)：使用浏览器访问 index.jsp 时会执行此过滤器。

@WebFilter(value = "/index.jsp", dispatcherTypes = DispatcherType.FORWARD)：转发访问 index.jsp 时会执行此过滤器。

@WebFilter(value = "/index.jsp", dispatcherTypes = {DispatcherType.REQUEST, DispatcherType.FORWARD})：使用浏览器或者转发访问 index.jsp 时会执行此过滤器。

dispatcherTypes 属性有如下几个值：

REQUEST：默认值。浏览器直接请求资源

FORWARD：转发访问资源

INCLUDE：包含访问资源

ERROR：错误跳转资源

ASYNC：异步访问资源

如果是采用的 xml 配置的方式，添加 <dispatcher></dispatcher> 即可。

过滤器的执行顺序和过滤器配置方式有关，如果是采用 xml 配置的，会根据 web.xml 文件中出现的先后顺序执行。如果是采用注解的方式进行配置的，则会按照类名的字符串进行比较，值小的先执行。如 AFilter 和 BFilter，AFilter 会先执行。

一个过滤器在一次请求中会执行两次，分别于访问资源执行前后执行。如果存在多个过滤器，它的执行顺序是这样的：

过滤器1

过滤器2

资源执行

过滤器2

过滤器1